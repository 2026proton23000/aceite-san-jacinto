<!DOCTYPE html>
<html lang="es-PE">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aceite de Oliva Extra Virgen ¬∑ San Jacinto</title>
    <!-- Google Fonts : Playfair Display (t√≠tulos) & Inter (texto) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome 6 (gratuito) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* (Le style reste inchang√©, je l'ai conserv√© √† l'identique) */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #faf9f7;
            color: #1e1e1e;
            line-height: 1.5;
        }

        /* Variables de colores */
        :root {
            --vert-profond: #2C4C3B;
            --or-mat: #C5A059;
            --gris-clair: #f4f4f4;
            --ombre: 0 20px 30px -10px rgba(0,0,0,0.15);
        }

        /* Encabezado con degradado e imagen de fondo */
        .header {
            background: linear-gradient(145deg, #1f3a2c 0%, #2C4C3B 100%);
            color: white;
            padding: 2.5rem 1rem;
            text-align: center;
            position: relative;
            border-bottom: 6px solid var(--or-mat);
            overflow: hidden;
        }

        .header-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.1;
            pointer-events: none;
            z-index: 0;
        }

        .header-bg img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 3.2rem;
            font-weight: 900;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
            text-shadow: 3px 3px 0 rgba(0,0,0,0.2);
        }

        .header h1 span {
            color: var(--or-mat);
        }

        .header p {
            font-size: 1.2rem;
            font-weight: 300;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(5px);
            display: inline-block;
            padding: 0.5rem 2rem;
            border-radius: 50px;
            border: 1px solid var(--or-mat);
            margin-top: 0.5rem;
        }

        .info-bar {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1.5rem;
            margin: 1.5rem 0 1rem;
        }

        .info-bar span {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(5px);
            padding: 0.6rem 1.5rem;
            border-radius: 40px;
            font-size: 1rem;
            border: 1px solid rgba(197,160,89,0.3);
        }

        /* Contenedor principal */
        .contenedor {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        @media (min-width: 1000px) {
            .contenedor {
                flex-direction: row;
                align-items: flex-start;
            }
        }

        /* Secci√≥n men√∫ */
        .menu {
            flex: 2;
        }

        .categoria {
            background: white;
            border-radius: 32px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--ombre);
            border: 1px solid rgba(44,76,59,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .categoria:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 40px -12px rgba(44,76,59,0.3);
        }

        .categoria h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2.2rem;
            color: var(--vert-profond);
            font-weight: 700;
            margin-bottom: 0.25rem;
            border-left: 8px solid var(--or-mat);
            padding-left: 1.2rem;
        }

        .categoria .sous-titre {
            font-size: 1rem;
            font-weight: 400;
            color: #666;
            margin: 0 0 1.5rem 1.8rem;
            font-style: italic;
            background: var(--gris-clair);
            display: inline-block;
            padding: 0.3rem 1.5rem;
            border-radius: 40px;
        }

        /* Tarjeta producto */
        .plato {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 1.2rem;
            padding: 1.5rem 0;
            border-bottom: 1px solid #eaeaea;
        }

        .plato:last-child {
            border-bottom: none;
        }

        .plato-info {
            flex: 2 1 250px;
        }

        .plato-nombre {
            font-weight: 700;
            font-size: 1.25rem;
            color: var(--vert-profond);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .plato-nombre i {
            color: var(--or-mat);
            font-size: 1.1rem;
        }

        .plato-desc {
            font-size: 0.9rem;
            color: #666;
            margin-top: 0.3rem;
            line-height: 1.4;
        }

        .plato-precio {
            font-weight: 800;
            color: var(--or-mat);
            background: #fcf6e9;
            padding: 0.4rem 1.2rem;
            border-radius: 40px;
            font-size: 1.3rem;
            white-space: nowrap;
            border: 1px solid rgba(197,160,89,0.3);
        }

        .plato-controles {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            background: #f0f0f0;
            padding: 0.2rem;
            border-radius: 40px;
            margin-left: auto;
        }

        .plato-controles button {
            background: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--vert-profond);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.15s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .plato-controles button:hover {
            background: var(--vert-profond);
            color: white;
            transform: scale(1.05);
        }

        .plato-controles .cantidad {
            min-width: 36px;
            text-align: center;
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--vert-profond);
        }

        /* Carrito */
        .pedido {
            flex: 1;
            background: white;
            border-radius: 36px;
            padding: 2rem 1.8rem;
            box-shadow: var(--ombre);
            border: 2px solid var(--or-mat);
            position: sticky;
            top: 1.5rem;
            max-height: 90vh;
            overflow-y: auto;
        }

        .pedido h3 {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            color: var(--vert-profond);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 2px solid var(--or-mat);
            padding-bottom: 1rem;
        }

        .pedido h3 i {
            color: var(--or-mat);
            font-size: 2rem;
        }

        #lista-pedido {
            list-style: none;
            margin-bottom: 1.5rem;
            max-height: 300px;
            overflow-y: auto;
            padding-right: 5px;
        }

        #lista-pedido li {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
            padding: 0.8rem 0;
            border-bottom: 1px dashed #ddd;
        }

        .item-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .item-nombre {
            font-weight: 600;
            flex: 2;
            color: #1e1e1e;
        }

        .item-precio {
            font-weight: 700;
            color: var(--or-mat);
        }

        .item-actions {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 0.2rem;
        }

        .mini-controles {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            background: #f0f0f0;
            padding: 0.2rem;
            border-radius: 30px;
        }

        .mini-controles button {
            background: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--vert-profond);
            cursor: pointer;
            transition: 0.1s;
        }

        .mini-controles button:hover {
            background: var(--vert-profond);
            color: white;
        }

        .btn-eliminar {
            background: none;
            border: none;
            color: #888;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.2rem 0.5rem;
            transition: color 0.2s;
        }

        .btn-eliminar:hover {
            color: #c00;
        }

        .total {
            font-size: 2rem;
            font-weight: 800;
            color: var(--vert-profond);
            text-align: right;
            margin: 1rem 0;
            padding-top: 0.5rem;
            border-top: 3px solid var(--or-mat);
        }

        .campo {
            margin: 1.2rem 0;
        }

        .campo label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.3rem;
            color: var(--vert-profond);
        }

        .campo input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 60px;
            font-size: 1rem;
            transition: 0.2s;
        }

        .campo input:focus {
            border-color: var(--or-mat);
            outline: none;
            box-shadow: 0 0 0 3px rgba(197,160,89,0.2);
        }

        .btn-pedido {
            background: var(--vert-profond);
            color: white;
            border: none;
            width: 100%;
            padding: 1.2rem;
            font-size: 1.4rem;
            font-weight: 800;
            border-radius: 60px;
            margin-top: 1rem;
            cursor: pointer;
            transition: 0.2s;
            box-shadow: 0 8px 0 #1f3a2c;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-pedido:active {
            transform: translateY(4px);
            box-shadow: 0 4px 0 #1f3a2c;
        }

        .btn-pedido i {
            margin-right: 8px;
            color: var(--or-mat);
        }

        .pedido-vacio {
            text-align: center;
            color: #aaa;
            padding: 2rem;
            font-size: 1rem;
            border: 2px dashed #ccc;
            border-radius: 36px;
        }

        /* Footer */
        .footer {
            background: #1e1e1e;
            color: #aaa;
            text-align: center;
            padding: 2rem;
            margin-top: 3rem;
            border-top: 6px solid var(--or-mat);
            font-size: 0.95rem;
        }

        .footer a {
            color: var(--or-mat);
            text-decoration: none;
        }

        /* Badge "Nuevo" */
        .badge {
            background: var(--or-mat);
            color: white;
            font-size: 0.7rem;
            font-weight: 700;
            padding: 0.2rem 0.6rem;
            border-radius: 20px;
            margin-left: 10px;
            text-transform: uppercase;
        }

        /* Llamados a la acci√≥n peruanos */
        .accion {
            font-size: 0.9rem;
            color: var(--vert-profond);
            text-align: center;
            margin-top: 1rem;
            font-style: normal;
            background: #fcf6e9;
            padding: 0.7rem;
            border-radius: 30px;
            border: 1px dashed var(--or-mat);
            font-weight: 500;
        }

        .accion i {
            color: var(--or-mat);
            margin-right: 5px;
        }

        /* Sello de confianza */
        .sello {
            display: inline-block;
            background: var(--vert-profond);
            color: white;
            font-size: 0.7rem;
            padding: 0.2rem 0.8rem;
            border-radius: 20px;
            margin-left: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-bg">
            <!-- Reemplaza por la ruta de tu imagen generada por Gemini -->
            <img src="fond-olive.png" alt="" onerror="this.style.display='none'">
        </div>
        <div class="header-content">
            <h1>ACEITE DE OLIVA <span>EXTRA VIRGEN</span></h1>
            <p>San Jacinto ¬∑ Venta entre vecinos</p>
            <div class="info-bar">
                <span><i class="fas fa-tint"></i> Virgen extra</span>
                <span><i class="fas fa-leaf"></i> Cosecha 2025</span>
                <span><i class="fas fa-hand-holding-heart"></i> Directo del productor</span>
            </div>
            <!-- Sin tel√©fono fijo, solo contacto por el pedido -->
        </div>
    </header>

    <div class="contenedor">
        <!-- Secci√≥n productos -->
        <div class="menu">
            <div class="categoria">
                <h2>ACEITE DE OLIVA EXTRA VIRGEN <span class="sello">solo para vecinos</span></h2>
                <div class="sous-titre">Extra√≠do en fr√≠o, 100% puro ¬∑ Calidad premium</div>

                <!-- Producto 1L -->
                <div class="plato" data-nombre="Aceite de oliva 1L" data-desc="Botella de 1 litro" data-precio="35">
                    <div class="plato-info">
                        <span class="plato-nombre"><i class="fas fa-wine-bottle"></i> Botella 1 litro <span class="badge">üî• m√°s vendido</span></span>
                        <div class="plato-desc">Para cocinar, ensaladas y hasta para el pan. ¬°Rendidor!</div>
                    </div>
                    <div class="plato-precio">S/ 35</div>
                    <div class="plato-controles">
                        <button class="btn-menos">‚àí</button>
                        <span class="cantidad">0</span>
                        <button class="btn-mas">+</button>
                    </div>
                </div>

                <!-- Producto 500ml -->
                <div class="plato" data-nombre="Aceite de oliva 500ml" data-desc="Medio litro" data-precio="18">
                    <div class="plato-info">
                        <span class="plato-nombre"><i class="fas fa-wine-bottle"></i> Botella 500 ml <span class="badge">ü§è para probar</span></span>
                        <div class="plato-desc">Perfecto para empezar a disfrutar o para llevar de regalo</div>
                    </div>
                    <div class="plato-precio">S/ 18</div>
                    <div class="plato-controles">
                        <button class="btn-menos">‚àí</button>
                        <span class="cantidad">0</span>
                        <button class="btn-mas">+</button>
                    </div>
                </div>

                <!-- Pack 3 x 1L -->
                <div class="plato" data-nombre="Pack 3 x 1L" data-desc="Ahorra 10%" data-precio="95">
                    <div class="plato-info">
                        <span class="plato-nombre"><i class="fas fa-box"></i> Pack 3 botellas (1L) <span class="badge">üí• ahorro asegurado</span></span>
                        <div class="plato-desc">3 litros por S/95 ¬∑ Ideal para la familia o para compartir con tu causa</div>
                    </div>
                    <div class="plato-precio">S/ 95</div>
                    <div class="plato-controles">
                        <button class="btn-menos">‚àí</button>
                        <span class="cantidad">0</span>
                        <button class="btn-mas">+</button>
                    </div>
                </div>

                <!-- Mensaje adicional -->
                <div style="text-align:center; margin-top:1.5rem; padding:0.5rem; background:#f0f0f0; border-radius:30px;">
                    <p><i class="fas fa-truck" style="color:var(--or-mat);"></i> <strong>¬°Te lo llevamos a tu casa sin costo extra!</strong> Solo pon tu lote y horario.</p>
                </div>
            </div>
        </div>

        <!-- Carrito -->
        <aside class="pedido">
            <h3><i class="fas fa-shopping-bag"></i> Tu pedido</h3>
            <div id="pedido-contenido">
                <ul id="lista-pedido"></ul>
                <div id="total" class="total">S/ 0.00</div>
                <div class="campo">
                    <label for="direccion">üìç Direcci√≥n de entrega (lote / calle)</label>
                    <input type="text" id="direccion" placeholder="Ej: B22, San Jacinto">
                </div>
                <div class="campo">
                    <label for="telefono">üìû Tu celular (Yape / Plin / llamada)</label>
                    <input type="tel" id="telefono" placeholder="Ej: 999 888 222">
                </div>
                <!-- Nuevo campo: hora deseada -->
                <div class="campo">
                    <label for="hora">‚è∞ ¬øA qu√© hora te cae mejor que lleguemos?</label>
                    <input type="text" id="hora" placeholder="Ej: 6pm - 8pm / 10am - 12pm">
                </div>
                <!-- Llamado a la acci√≥n peruano -->

                <button class="btn-pedido" id="enviar-pedido">
                    <i class="fab fa-whatsapp"></i> Enviar pedido por WhatsApp
                </button>
                <p style="font-size:0.8rem; text-align:center; margin-top:0.5rem; color:#666;">Tambi√©n aceptamos <strong>Yape</strong>, <strong>Plin</strong> y efectivo. Cuando recibamos tu pedido, te contactamos.</p>
            </div>
            <div id="pedido-vacio" class="pedido-vacio">
                <i class="fas fa-box-open" style="font-size: 3rem; opacity: 0.4;"></i>
                <p><strong>¬°Qu√© esaa, vecino!</strong> Elige tus botellas y te las llevamos al toque.</p>
                <p style="font-size:0.9rem; margin-top:0.5rem;">üíö Aceite de primera, precio bueno.</p>
            </div>
        </aside>
    </div>

    <footer class="footer">
        <p>üç∏ <strong>Aceite de Oliva Extra Virgen San Jacinto</strong> ‚Äî directo del productor a tu casa.</p>
        <p>üìç Recojo en el condominio o delivery sin costo ¬∑ Paga como quieras: Yape, Plin, efectivo.</p>
        <p><a href="#"><i class="fas fa-heart" style="color: var(--or-mat);"></i> Hecho con cari√±o para sus vecinos de San Jacinto</a></p>
        <p style="margin-top:0.8rem; font-size:0.85rem;">üì¶ ¬øQuieres horario especial? <strong>¬°Solo ponlo en el pedido y coordinamos!</strong> Estamos para servirte.</p>
        <p style="margin-top:1rem;">üáµüá™üáµüá™üáµüá™</p>
    </footer>

    <script>
        // Estado del pedido
        let pedido = {};
        let total = 0;

        // Elementos del DOM
        const listaPedido = document.getElementById('lista-pedido');
        const totalSpan = document.getElementById('total');
        const pedidoVacio = document.getElementById('pedido-vacio');
        const pedidoContenido = document.getElementById('pedido-contenido');
        const direccionInput = document.getElementById('direccion');
        const telefonoInput = document.getElementById('telefono');
        const horaInput = document.getElementById('hora');
        const btnEnviar = document.getElementById('enviar-pedido');

        // ===== CONFIGURACI√ìN GOOGLE SHEETS =====
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzXaLqKT_eCc0Verp0BBXDjyIuPFytRw7k5DxZDEkxZPsdR8nA6Qmq6LPaTplZlhd03Ow/exec';

        // Funci√≥n para generar una clave √∫nica
        function getKey(nombre, desc) {
            return nombre + '¬∑' + (desc || '');
        }

        // Asignar eventos a los botones + y - del men√∫
        document.querySelectorAll('.plato').forEach(plato => {
            const nombre = plato.dataset.nombre;
            const desc = plato.dataset.desc;
            const precio = parseFloat(plato.dataset.precio);
            const btnMas = plato.querySelector('.btn-mas');
            const btnMenos = plato.querySelector('.btn-menos');
            const spanCant = plato.querySelector('.cantidad');

            const clave = getKey(nombre, desc);

            btnMas.addEventListener('click', () => {
                if (!pedido[clave]) {
                    pedido[clave] = { cantidad: 0, precio, nombre, desc };
                }
                pedido[clave].cantidad++;
                spanCant.textContent = pedido[clave].cantidad;
                actualizarPedido();
            });

            btnMenos.addEventListener('click', () => {
                if (pedido[clave] && pedido[clave].cantidad > 0) {
                    pedido[clave].cantidad--;
                    spanCant.textContent = pedido[clave].cantidad;
                    if (pedido[clave].cantidad === 0) delete pedido[clave];
                    actualizarPedido();
                }
            });
        });

        // Actualizaci√≥n completa del carrito
        function actualizarPedido() {
            // Actualiza los contadores en el men√∫
            document.querySelectorAll('.plato').forEach(plato => {
                const nombre = plato.dataset.nombre;
                const desc = plato.dataset.desc;
                const clave = getKey(nombre, desc);
                const spanCant = plato.querySelector('.cantidad');
                spanCant.textContent = pedido[clave] ? pedido[clave].cantidad : 0;
            });

            // Genera la lista del carrito
            total = 0;
            let itemsHtml = '';
            for (let clave in pedido) {
                const item = pedido[clave];
                const subtotal = item.cantidad * item.precio;
                total += subtotal;
                itemsHtml += `
                    <li>
                        <div class="item-row">
                            <span class="item-nombre">${item.nombre} ${item.desc ? `<small>(${item.desc})</small>` : ''}</span>
                            <span class="item-precio">S/ ${subtotal.toFixed(2)}</span>
                        </div>
                        <div class="item-actions">
                            <div class="mini-controles">
                                <button class="btn-menos-pedido" data-clave="${clave}">‚àí</button>
                                <span class="cantidad-pedido">${item.cantidad}</span>
                                <button class="btn-mas-pedido" data-clave="${clave}">+</button>
                            </div>
                            <button class="btn-eliminar" data-clave="${clave}">üóëÔ∏è</button>
                        </div>
                    </li>
                `;
            }

            if (itemsHtml === '') {
                pedidoVacio.style.display = 'block';
                pedidoContenido.style.display = 'none';
            } else {
                pedidoVacio.style.display = 'none';
                pedidoContenido.style.display = 'block';
                listaPedido.innerHTML = itemsHtml;
                totalSpan.textContent = `S/ ${total.toFixed(2)}`;

                // Eventos para los botones del carrito
                document.querySelectorAll('.btn-mas-pedido').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const clave = e.target.dataset.clave;
                        if (pedido[clave]) {
                            pedido[clave].cantidad++;
                            actualizarPedido();
                        }
                    });
                });
                document.querySelectorAll('.btn-menos-pedido').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const clave = e.target.dataset.clave;
                        if (pedido[clave]) {
                            pedido[clave].cantidad--;
                            if (pedido[clave].cantidad <= 0) delete pedido[clave];
                            actualizarPedido();
                        }
                    });
                });
                document.querySelectorAll('.btn-eliminar').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const clave = e.target.dataset.clave;
                        delete pedido[clave];
                        actualizarPedido();
                    });
                });
            }
        }

        // ===== SUIVI DES VISITES GOOGLE SHEETS =====
        (function() {
            // G√©n√©rer un identifiant unique pour le visiteur (stock√© dans localStorage)
            let userId = localStorage.getItem('visitor_id');
            if (!userId) {
                userId = 'user_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
                localStorage.setItem('visitor_id', userId);
            }

            // Incr√©menter le compteur de visites pour cet utilisateur
            let visitCount = parseInt(localStorage.getItem('visit_count') || '0') + 1;
            localStorage.setItem('visit_count', visitCount);

            // Envoyer les donn√©es au script Google Sheets (avec type='visit')
            fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: new URLSearchParams({
                    type: 'visit',
                    userId: userId,
                    page: window.location.pathname,
                    visitCount: visitCount
                })
            })
            .then(() => console.log('‚úÖ Visite enregistr√©e dans Google Sheets'))
            .catch(err => console.error('‚ùå Erreur lors de l\'envoi de la visite :', err));
        })();

        // ===== CONFIGURACI√ìN TELEGRAM =====
        const TELEGRAM_TOKEN = '8144991223:AAGs60-oFtaZQmQUPnHPNMULGGb_SU6uSI8';
        const TELEGRAM_CHAT_ID = '6051665667';

        async function enviarATelegram(mensaje) {
            const url = `https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`;
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: TELEGRAM_CHAT_ID,
                        text: mensaje,
                        parse_mode: 'Markdown'
                    })
                });
                return response.ok;
            } catch (error) {
                console.error('Error:', error);
                return false;
            }
        }

        btnEnviar.addEventListener('click', async () => {
            const direccion = direccionInput.value.trim();
            const telefono = telefonoInput.value.trim();
            const hora = horaInput.value.trim();

            if (Object.keys(pedido).length === 0) {
                alert('‚ùå Oye causa, primero elige tus botellas.');
                return;
            }
            if (!direccion) {
                alert('üìù Pon tu direcci√≥n (lote) para que sepamos d√≥nde llevarte el aceite.');
                return;
            }
            if (!telefono) {
                alert('üìû Necesitamos tu celular para coordinarte la entrega (Yape tambi√©n).');
                return;
            }

            // Pr√©parer le message pour Telegram
            let mensaje = "ü´í *Nuevo pedido de aceite de oliva ‚Äì San Jacinto*\n\n";
            for (let clave in pedido) {
                const item = pedido[clave];
                mensaje += `‚Ä¢ ${item.nombre} x${item.cantidad} = S/ ${(item.cantidad * item.precio).toFixed(2)}\n`;
            }
            mensaje += `\nüí∞ *Total : S/ ${total.toFixed(2)}*`;
            mensaje += `\nüìç *Direcci√≥n:* ${direccion}`;
            mensaje += `\nüìû *Tel√©fono:* ${telefono}`;
            if (hora) {
                mensaje += `\n‚è∞ *Hora deseada:* ${hora}`;
            }

            // Envoyer √† Telegram
            const ok = await enviarATelegram(mensaje);

            // Envoyer la commande √† Google Sheets (m√™me si Telegram √©choue, on tente)
            try {
                const commandeData = {
                    type: 'commande',
                    userId: localStorage.getItem('visitor_id'),
                    produits: JSON.stringify(pedido), // on envoie tout le panier en JSON
                    total: total.toFixed(2),
                    adresse: direccion,
                    telephone: telefono,
                    heure: hora
                };
                fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: new URLSearchParams(commandeData)
                }).catch(err => console.error('Erreur envoi commande Sheets:', err));
            } catch (e) {
                console.error('Erreur lors de la pr√©paration de la commande Sheets:', e);
            }

            if (ok) {
                alert('‚úÖ ¬°Pedido enviado, gracias! Te contactaremos al toque para coordinar. ¬°Yapa incluida!');
                pedido = {};
                direccionInput.value = '';
                telefonoInput.value = '';
                horaInput.value = '';
                actualizarPedido();
            } else {
                alert('‚ùå Algo fall√≥. Intenta de nuevo o escr√≠benos directo.');
            }
        });

        // Inicializaci√≥n
        actualizarPedido();
    </script>
</body>
</html>